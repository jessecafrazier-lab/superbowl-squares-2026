<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Bowl 2026 Squares</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
            font-size: 1.2em;
        }
        
        .sync-status {
            text-align: center;
            color: #28a745;
            font-weight: 600;
            margin-bottom: 20px;
            padding: 10px;
            background: #d4edda;
            border-radius: 8px;
        }
        
        .sync-status.disconnected {
            color: #dc3545;
            background: #f8d7da;
        }
        
        .controls {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        label {
            font-weight: 600;
            color: #555;
            font-size: 0.9em;
        }
        
        input, button, select {
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
        }
        
        input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .grid-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
            overflow-x: auto;
            width: 100%;
        }
        
        .grid-wrapper {
            display: inline-block;
            min-width: min-content;
        }
        
        .grid-and-side {
            display: flex;
            gap: 10px;
            align-items: stretch;
        }
        
        @media (max-width: 768px) {
            .grid-container {
                overflow-x: scroll;
                -webkit-overflow-scrolling: touch;
            }
            
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            .subtitle {
                font-size: 1em;
            }
        }
        
        .team-label-top {
            text-align: center;
            font-weight: bold;
            font-size: 1.2em;
            color: #333;
            margin-bottom: 10px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 8px;
        }
        
        .grid-with-numbers {
            display: grid;
            grid-template-columns: 40px repeat(10, 60px);
            grid-template-rows: 40px repeat(10, 60px);
            gap: 2px;
            background: #ddd;
            padding: 2px;
            border-radius: 8px;
            width: fit-content;
        }
        
        .corner {
            background: #333;
        }
        
        .number-cell {
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
            background: #f8f9fa;
            color: #333;
            min-height: 38px;
            min-width: 38px;
        }
        
        .square {
            background: white;
            border: 1px solid #ddd;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.75em;
            padding: 2px;
            transition: all 0.2s;
            text-align: center;
            word-wrap: break-word;
            overflow: hidden;
            min-height: 58px;
            min-width: 58px;
        }
        
        .square:hover:not(.claimed) {
            background: #e3f2fd;
            transform: scale(1.05);
        }
        
        .square.claimed {
            background: #c8e6c9;
            cursor: default;
        }
        
        .square.temp-selected {
            background: #fff9c4;
            border: 2px solid #ffc107;
            cursor: pointer;
        }
        
        .square.locked {
            background: #a5d6a7;
            cursor: not-allowed;
            font-weight: bold;
        }
        
        .square.winner {
            background: #ffd700;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .team-label-side {
            writing-mode: vertical-rl;
            transform: rotate(180deg);
            font-weight: bold;
            font-size: 1.2em;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f0f0f0;
            border-radius: 8px;
            padding: 10px 5px;
            min-width: 40px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .stat-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
        }
        
        .stat-box h3 {
            color: #333;
            margin-bottom: 15px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        .player-stat {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .player-stat:last-child {
            border-bottom: none;
        }
        
        .quarter-winner {
            background: #fff3cd;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            border-left: 4px solid #ffc107;
        }
        
        .info-message {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
            color: #1976d2;
            font-weight: 500;
        }
        
        .reset-btn {
            background: #dc3545;
            margin-top: 20px;
        }
        
        .reset-btn:hover {
            background: #c82333;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèà Super Bowl 2026 Squares üèà</h1>
        <div class="subtitle">$1 per square | Q1: $20 | Q2: $20 | Q3: $20 | Final: $40</div>
        <div class="sync-status" id="syncStatus">üîÑ Connecting to Firebase...</div>
        
        <div class="controls">
            <div class="control-group">
                <label for="team1Name">Team 1 Name (Top):</label>
                <input type="text" id="team1Name" placeholder="e.g., Chiefs">
            </div>
            <div class="control-group">
                <label for="team2Name">Team 2 Name (Side):</label>
                <input type="text" id="team2Name" placeholder="e.g., Eagles">
            </div>
            <button id="updateTeams">Set Team Names</button>
        </div>
        
        <div class="controls">
            <button id="assignNumbers">Assign Random Numbers</button>
            <button id="testConnection" style="background: #17a2b8;">Test Firebase Connection</button>
            <button id="resetGame" class="reset-btn">Reset Game</button>
        </div>
        
        <div id="infoMessage" class="info-message"></div>
        
        <div class="controls">
            <div class="control-group">
                <label for="playerInitials">Your Initials:</label>
                <input type="text" id="playerInitials" placeholder="e.g., JD" maxlength="3">
            </div>
            <button id="lockSquares" style="background: #28a745;">Lock In My Squares</button>
            <button id="clearMySquares" style="background: #ffc107; color: #333;">Clear My Selection</button>
        </div>
        
        <div id="selectionMessage" class="info-message" style="background: #fff3cd; color: #856404; display: none;"></div>
        
        <div class="grid-container">
            <div class="grid-wrapper">
                <div class="team-label-top" id="team1Label">Team 1</div>
                <div class="grid-and-side">
                    <div class="team-label-side" id="team2Label">Team 2</div>
                    <div class="grid-with-numbers" id="grid"></div>
                </div>
            </div>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <label for="team1Score">Team 1 Score:</label>
                <input type="number" id="team1Score" min="0" value="0">
            </div>
            <div class="control-group">
                <label for="team2Score">Team 2 Score:</label>
                <input type="number" id="team2Score" min="0" value="0">
            </div>
            <div class="control-group">
                <label for="quarter">Quarter:</label>
                <select id="quarter">
                    <option value="1">Q1</option>
                    <option value="2">Q2</option>
                    <option value="3">Q3</option>
                    <option value="4">Q4</option>
                    <option value="final">Final</option>
                </select>
            </div>
            <button id="updateScore">Update Score & Check Winner</button>
        </div>
        
        <div class="stats">
            <div class="stat-box">
                <h3>Player Statistics</h3>
                <div id="playerStats"></div>
            </div>
            <div class="stat-box">
                <h3>Quarter Winners</h3>
                <div id="quarterWinners"></div>
            </div>
        </div>
    </div>
    
    <!-- Firebase SDK v9 - Modular -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
        import { getDatabase, ref, set, onValue } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js';
        
        const GRID_SIZE = 10;
        const KICKOFF_DATE = new Date('2026-02-09T18:30:00-05:00'); // Super Bowl LIX kickoff - adjust timezone as needed
        
        let gameState = {
            squares: [],
            team1Numbers: [],
            team2Numbers: [],
            numbersAssigned: false,
            team1Name: 'Team 1',
            team2Name: 'Team 2',
            quarterWinners: {},
            playerStats: {},
            playerBids: {} // Track how many squares each player wants
        };
        
        // Temporary selection tracker (not saved to Firebase until locked)
        let myTempSelection = [];
        
        let database = null;
        let gameRef = null;
        
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA4-rKQRBzTGJTYGsXPcZfGF1oB4TTxG80",
            authDomain: "superbowl-squares-a8765.firebaseapp.com",
            databaseURL: "https://superbowl-squares-a8765-default-rtdb.firebaseio.com",
            projectId: "superbowl-squares-a8765",
            storageBucket: "superbowl-squares-a8765.firebasestorage.app",
            messagingSenderId: "577853522438",
            appId: "1:577853522438:web:a78db268c11f330af87987"
        };
        
        function updateSyncStatus(message, connected) {
            const status = document.getElementById('syncStatus');
            status.textContent = message;
            status.className = connected ? 'sync-status' : 'sync-status disconnected';
        }
        
        function initializeFirebase() {
            try {
                console.log('Initializing Firebase...');
                const app = initializeApp(firebaseConfig);
                console.log('Firebase app initialized:', app.name);
                
                database = getDatabase(app);
                console.log('Database instance created');
                
                gameRef = ref(database, 'superbowl-squares-2026');
                console.log('Game reference created');
                
                // Listen for changes
                onValue(gameRef, (snapshot) => {
                    console.log('Firebase data received');
                    const data = snapshot.val();
                    console.log('Data from Firebase:', data);
                    
                    if (data) {
                        gameState = data;
                        console.log('Game state updated from Firebase');
                        updateDisplay();
                    } else {
                        console.log('No data in Firebase yet - using default state');
                    }
                    updateSyncStatus('‚úÖ Connected - Real-time sync active', true);
                }, (error) => {
                    console.error('Firebase onValue error:', error);
                    updateSyncStatus('‚ùå Error loading data: ' + error.message, false);
                });
                
                updateSyncStatus('‚úÖ Connected to Firebase - Real-time sync active!', true);
                console.log('Firebase initialization complete');
            } catch (e) {
                console.error('Firebase initialization error:', e);
                updateSyncStatus('‚ùå Firebase connection error: ' + e.message, false);
            }
        }
        
        async function testConnection() {
            try {
                console.log('Testing Firebase connection...');
                const testData = { test: 'connection', timestamp: Date.now() };
                await set(ref(database, 'connection-test'), testData);
                alert('‚úÖ Firebase connection successful! Data was written and should be visible in Firebase Console.');
                console.log('Test successful - data written to Firebase');
            } catch (error) {
                console.error('Connection test failed:', error);
                alert('‚ùå Firebase connection failed: ' + error.message);
            }
        }
        
        async function saveGameState() {
            try {
                await set(gameRef, gameState);
            } catch (error) {
                console.error('Error saving game state:', error);
                updateSyncStatus('‚ùå Error saving data: ' + error.message, false);
            }
        }
        
        function initializeGrid() {
            const grid = document.getElementById('grid');
            if (!grid) {
                console.error('Grid element not found!');
                return;
            }
            
            grid.innerHTML = '';
            console.log('Initializing grid with GRID_SIZE:', GRID_SIZE);
            console.log('Numbers assigned:', gameState.numbersAssigned);
            
            // Corner cell
            const corner = document.createElement('div');
            corner.className = 'corner';
            grid.appendChild(corner);
            
            // Top numbers
            for (let i = 0; i < GRID_SIZE; i++) {
                const numCell = document.createElement('div');
                numCell.className = 'number-cell';
                numCell.textContent = (gameState.numbersAssigned && gameState.team1Numbers && gameState.team1Numbers[i] !== undefined) ? gameState.team1Numbers[i] : '?';
                grid.appendChild(numCell);
            }
            
            // Rows with side numbers
            for (let row = 0; row < GRID_SIZE; row++) {
                // Side number
                const sideNum = document.createElement('div');
                sideNum.className = 'number-cell';
                sideNum.textContent = (gameState.numbersAssigned && gameState.team2Numbers && gameState.team2Numbers[row] !== undefined) ? gameState.team2Numbers[row] : '?';
                grid.appendChild(sideNum);
                
                // Squares
                for (let col = 0; col < GRID_SIZE; col++) {
                    const square = document.createElement('div');
                    square.className = 'square';
                    square.dataset.row = row;
                    square.dataset.col = col;
                    
                    const index = row * GRID_SIZE + col;
                    const squareData = gameState.squares && gameState.squares[index];
                    
                    // Check if this square is locked (saved to Firebase)
                    if (squareData && squareData.initials && squareData.locked) {
                        square.classList.add('locked');
                        square.textContent = squareData.initials;
                    }
                    // Check if this square is in temporary selection
                    else if (myTempSelection.includes(index)) {
                        square.classList.add('temp-selected');
                        square.textContent = '‚úì';
                    }
                    
                    square.addEventListener('click', () => toggleSquareSelection(row, col));
                    grid.appendChild(square);
                }
            }
            
            console.log('Grid initialized with', grid.children.length, 'total cells (should be 121)');
            updateAssignButton();
            updateSelectionMessage();
        }
        
        function toggleSquareSelection(row, col) {
            if (!gameState.numbersAssigned) {
                alert('Please assign random numbers first before selecting squares!');
                return;
            }
            
            const index = row * GRID_SIZE + col;
            const squareData = gameState.squares && gameState.squares[index];
            
            // If square is already locked by someone, can't select it
            if (squareData && squareData.locked) {
                alert(`This square is locked by ${squareData.initials}`);
                return;
            }
            
            // Toggle selection
            const selectionIndex = myTempSelection.indexOf(index);
            if (selectionIndex > -1) {
                // Deselect
                myTempSelection.splice(selectionIndex, 1);
            } else {
                // Select
                myTempSelection.push(index);
            }
            
            initializeGrid(); // Refresh to show selection
        }
        
        function lockInSquares() {
            const initials = document.getElementById('playerInitials').value.trim().toUpperCase();
            
            if (!initials) {
                alert('Please enter your initials first!');
                return;
            }
            
            if (initials.length < 2 || initials.length > 3) {
                alert('Please enter 2-3 initials (e.g., JD or JDM)');
                return;
            }
            
            if (myTempSelection.length === 0) {
                alert('Please select at least one square first!');
                return;
            }
            
            const cost = myTempSelection.length;
            if (!confirm(`Lock in ${myTempSelection.length} square(s) for $${cost}? This cannot be undone!`)) {
                return;
            }
            
            // Lock all selected squares
            for (const index of myTempSelection) {
                if (!gameState.squares) {
                    gameState.squares = [];
                }
                gameState.squares[index] = {
                    initials: initials,
                    locked: true,
                    row: Math.floor(index / GRID_SIZE),
                    col: index % GRID_SIZE
                };
            }
            
            // Update player stats
            if (!gameState.playerStats) {
                gameState.playerStats = {};
            }
            if (!gameState.playerStats[initials]) {
                gameState.playerStats[initials] = { squares: 0, winnings: 0 };
            }
            gameState.playerStats[initials].squares += myTempSelection.length;
            
            // Save to Firebase
            saveGameState();
            
            // Clear temp selection
            myTempSelection = [];
            
            updateSelectionMessage('‚úÖ Locked in ' + cost + ' square(s) for $' + cost + '!');
        }
        
        function clearMySelection() {
            if (myTempSelection.length === 0) {
                alert('You have no squares selected!');
                return;
            }
            
            myTempSelection = [];
            initializeGrid();
            updateSelectionMessage();
        }
        
        function updateSelectionMessage(customMsg) {
            const msgDiv = document.getElementById('selectionMessage');
            
            if (customMsg) {
                msgDiv.style.display = 'block';
                msgDiv.style.background = '#d4edda';
                msgDiv.style.color = '#155724';
                msgDiv.textContent = customMsg;
                setTimeout(() => {
                    msgDiv.style.display = 'none';
                }, 5000);
                return;
            }
            
            if (myTempSelection.length > 0) {
                msgDiv.style.display = 'block';
                msgDiv.style.background = '#fff3cd';
                msgDiv.style.color = '#856404';
                msgDiv.textContent = `${myTempSelection.length} square(s) selected = $${myTempSelection.length}. Click "Lock In My Squares" to confirm.`;
            } else {
                msgDiv.style.display = 'none';
            }
        }
        
        function updateAssignButton() {
            const btn = document.getElementById('assignNumbers');
            btn.disabled = gameState.numbersAssigned;
            
            if (gameState.numbersAssigned) {
                btn.textContent = 'Numbers Already Assigned';
            } else {
                btn.textContent = 'Assign Random Numbers';
            }
        }
        
        function assignRandomNumbers() {
            if (gameState.numbersAssigned) return;
            
            gameState.team1Numbers = shuffleArray([...Array(10).keys()]);
            gameState.team2Numbers = shuffleArray([...Array(10).keys()]);
            gameState.numbersAssigned = true;
            
            saveGameState();
        }
        
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        function updateScore() {
            if (!gameState.numbersAssigned) {
                alert('Please assign numbers first!');
                return;
            }
            
            const team1Score = parseInt(document.getElementById('team1Score').value);
            const team2Score = parseInt(document.getElementById('team2Score').value);
            const quarter = document.getElementById('quarter').value;
            
            const team1Digit = team1Score % 10;
            const team2Digit = team2Score % 10;
            
            const team1Index = gameState.team1Numbers.indexOf(team1Digit);
            const team2Index = gameState.team2Numbers.indexOf(team2Digit);
            
            const winningSquareIndex = team2Index * GRID_SIZE + team1Index;
            const winner = gameState.squares[winningSquareIndex];
            
            // Prize amounts: Q1-Q3 = $20, Final = $40
            const winAmount = quarter === 'final' ? 40 : 20;
            
            if (winner && winner.initials && winner.locked) {
                if (!gameState.quarterWinners) {
                    gameState.quarterWinners = {};
                }
                
                if (!gameState.quarterWinners[quarter]) {
                    gameState.quarterWinners[quarter] = {
                        initials: winner.initials,
                        score: `${team1Score}-${team2Score}`,
                        amount: winAmount
                    };
                    
                    if (!gameState.playerStats) {
                        gameState.playerStats = {};
                    }
                    if (!gameState.playerStats[winner.initials]) {
                        gameState.playerStats[winner.initials] = { squares: 0, winnings: 0 };
                    }
                    gameState.playerStats[winner.initials].winnings += winAmount;
                    
                    saveGameState();
                    highlightWinner(team1Index, team2Index);
                    updateQuarterWinners();
                    updatePlayerStats();
                    updateInfoMessage(`${quarter.toUpperCase()}: ${winner.initials} wins $${winAmount}! (Score: ${team1Score}-${team2Score})`);
                } else {
                    updateInfoMessage(`${quarter.toUpperCase()} winner already recorded: ${gameState.quarterWinners[quarter].initials}`);
                }
            } else {
                updateInfoMessage('No player has locked in the winning square!');
            }
        }
        
        function highlightWinner(col, row) {
            const squares = document.querySelectorAll('.square');
            squares.forEach(sq => sq.classList.remove('winner'));
            
            const index = row * GRID_SIZE + col;
            if (squares[index]) {
                squares[index].classList.add('winner');
            }
        }
        
        function updatePlayerStats() {
            const statsDiv = document.getElementById('playerStats');
            const sorted = Object.entries(gameState.playerStats || {}).sort((a, b) => b[1].winnings - a[1].winnings);
            
            if (sorted.length === 0) {
                statsDiv.innerHTML = '<p style="color: #999;">No players yet</p>';
                return;
            }
            
            statsDiv.innerHTML = sorted.map(([initials, stats]) => `
                <div class="player-stat">
                    <strong>${initials}</strong>
                    <span>${stats.squares} squares ($${stats.squares}) | $${stats.winnings} won</span>
                </div>
            `).join('');
        }
        
        function checkKickoffAndHideReset() {
            const now = new Date();
            const resetBtn = document.getElementById('resetGame');
            
            if (now >= KICKOFF_DATE) {
                resetBtn.style.display = 'none';
            } else {
                resetBtn.style.display = 'inline-block';
            }
        }
        
        function updateQuarterWinners() {
            const winnersDiv = document.getElementById('quarterWinners');
            const quarters = ['1', '2', '3', '4', 'final'];
            
            const hasWinners = gameState.quarterWinners && Object.keys(gameState.quarterWinners).length > 0;
            
            if (!hasWinners) {
                winnersDiv.innerHTML = '<p style="color: #999;">No winners yet</p>';
                return;
            }
            
            winnersDiv.innerHTML = quarters.map(q => {
                const winner = gameState.quarterWinners[q];
                if (!winner) return '';
                const displayInitials = winner.initials || winner.player; // Backward compatibility
                return `
                    <div class="quarter-winner">
                        <strong>${q === 'final' ? 'Final' : 'Q' + q}:</strong> ${displayInitials} - $${winner.amount} (${winner.score})
                    </div>
                `;
            }).join('');
        }
        
        function updateTeamNames() {
            const team1 = document.getElementById('team1Name').value.trim() || 'Team 1';
            const team2 = document.getElementById('team2Name').value.trim() || 'Team 2';
            
            gameState.team1Name = team1;
            gameState.team2Name = team2;
            
            document.getElementById('team1Label').textContent = team1;
            document.getElementById('team2Label').textContent = team2;
            
            saveGameState();
            updateInfoMessage('Team names updated!');
        }
        
        function updateInfoMessage(message) {
            const msgDiv = document.getElementById('infoMessage');
            if (message) {
                msgDiv.textContent = message;
                msgDiv.style.display = 'block';
            } else {
                if (!gameState.numbersAssigned) {
                    msgDiv.textContent = 'Step 1: Set team names, then assign random numbers before players start claiming squares!';
                    msgDiv.style.display = 'block';
                } else {
                    const claimedCount = gameState.squares.filter(s => s && s.player).length;
                    msgDiv.textContent = `Numbers assigned! ${claimedCount}/100 squares claimed. Players can now claim squares below.`;
                    msgDiv.style.display = 'block';
                }
            }
        }
        
        function updateDisplay() {
            document.getElementById('team1Label').textContent = gameState.team1Name;
            document.getElementById('team2Label').textContent = gameState.team2Name;
            document.getElementById('team1Name').value = gameState.team1Name;
            document.getElementById('team2Name').value = gameState.team2Name;
            initializeGrid();
            updatePlayerStats();
            updateQuarterWinners();
            updateInfoMessage();
            checkKickoffAndHideReset();
        }
        
        async function resetGame() {
            if (confirm('Are you sure you want to reset the entire game? This cannot be undone!')) {
                gameState = {
                    squares: [],
                    team1Numbers: [],
                    team2Numbers: [],
                    numbersAssigned: false,
                    team1Name: 'Team 1',
                    team2Name: 'Team 2',
                    quarterWinners: {},
                    playerStats: {},
                    playerBids: {}
                };
                await saveGameState();
            }
        }
        
        // Make functions globally accessible
        window.toggleSquareSelection = toggleSquareSelection;
        window.assignRandomNumbers = assignRandomNumbers;
        window.updateScore = updateScore;
        window.updateTeamNames = updateTeamNames;
        window.resetGame = resetGame;
        window.testConnection = testConnection;
        window.lockInSquares = lockInSquares;
        window.clearMySelection = clearMySelection;
        
        // Event listeners
        document.getElementById('assignNumbers').addEventListener('click', assignRandomNumbers);
        document.getElementById('updateScore').addEventListener('click', updateScore);
        document.getElementById('updateTeams').addEventListener('click', updateTeamNames);
        document.getElementById('resetGame').addEventListener('click', resetGame);
        document.getElementById('testConnection').addEventListener('click', testConnection);
        document.getElementById('lockSquares').addEventListener('click', lockInSquares);
        document.getElementById('clearMySquares').addEventListener('click', clearMySelection);
        
        // Initialize Firebase and display
        initializeFirebase();
        updateDisplay();
    </script>
</body>
</html>
